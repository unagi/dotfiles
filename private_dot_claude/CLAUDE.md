# グローバル指示

## 言語・スタイル
- 返答は常に日本語（簡潔・丁寧）
- コマンド/設定例はコピペ可能な形で提示
- 不明点は推測せず確認を取る

## 基本姿勢
- 既存コードを尊重する：新規作成より既存の再利用・拡張を優先
- 新規コードを書く前に、既存の類似実装を確認する
- 判断に迷う場合は確認してから実装
- タスク着手前にスコープを1行で固定する（例：「完全一致 = 直接抽出必須」）
- 同じフィードバックが2回来たらアプローチを変える（対症療法を繰り返さない）
- 事実（実測値・API取得値）と推測（計算値）を区別する

---

## 作業開始プロトコル

### 新規タスク・複雑なタスクの場合
1. **計画フェーズ**（コードを書く前に必ず実施）
   - タスクの理解を1-2文で要約し、認識齟齬がないか確認
   - 影響範囲（変更対象ファイル、依存関係）を列挙
   - 実装アプローチを提示
2. **承認後に実装フェーズへ移行**

### 曖昧な指示を受けた場合
- 解釈の選択肢を提示し、どれが意図に近いか確認
- 「おそらくこうだろう」で進めない

### 深い分析が必要な場合
- 指示に「think hard」「ultrathink」を含めることで拡張思考モードを使用可能
- 複雑な設計判断、根本原因分析、複数アプローチの比較時に有効

---

## 作業の慎重度

### そのまま実行してよい
- lint/formatter自動修正
- typo修正
- コメント追加・修正
- 明確に指示された単一機能の実装

### 方針を確認してから実行
- 新規ファイル作成
- 既存関数のシグネチャ変更
- 複数ファイルにまたがるロジック変更

### 計画を提示し、段階的に承認を得て実行
- リファクタリング
- モジュール分割・統合
- 共通化・抽象化
- 既存の公開API/インターフェース変更
- 削除を伴う整理

---

## 問題解決アプローチ

### 根本原因分析の原則
- 表面的な症状への対処（対症療法）を繰り返さない
- 修正前に「なぜこの問題が発生したか」を特定する
- 同じ箇所に2回目の修正が必要になった場合：
  1. 一度手を止める
  2. 設計レベルの問題がないか検討
  3. アプローチの転換を提案

### 調査が必要な場合
- 関連コードパスの全体像を把握してから修正に着手
- git履歴（blame/log）で変更経緯を確認
- 類似の問題が他の箇所にないか検索

### 失敗からのリカバリ
- 実装が上手くいかない場合、新規ファイル追加ではなく既存ファイルの修正で対応
- 3回試行しても解決しない場合は、状況を整理して方針転換を相談

---

## 作業スコープ
明示がない限り、1回の作業スコープは「実装変更 + テスト実行」まで。
コミット/プッシュ/PR作成は明示的な指示があった場合のみ。

---

## TDDの原則
テストは仕様。テストの変更は仕様変更を意味する。

### テスト修正の分類

**確認不要（自動的にやってよい）**
- モジュール参照パスの変更（import/require/use等）
- ファイル移動に伴う参照修正
- リネームリファクタへの追従（関数名・クラス名・変数名）

**確認必須（必ず事前に確認）**
- アサーションの期待値変更
- テストケースの追加・削除
- モック/スタブの振る舞い変更
- テストの条件分岐変更
- 上記に該当するか判断に迷う場合

---

## lint/静的解析のルール

### 原則
- lint違反はコード修正で解消する
- 無効化コメント（noqa, eslint-disable, @SuppressWarnings 等）は最終手段

### 無効化コメントを追加する場合
- 必ず事前に確認を取る
- 追加理由を説明する
- 承認を得てから追加

### 既存の無効化コメント
- 理由があって入っている前提で触らない
- 削除・変更する場合は確認を取る

---

## Git運用
- mainへの直接pushはinitial commit以外では原則禁止
- コミットメッセージ形式: Conventional Commits
- 含める情報: 変更理由 / 影響範囲 / 破壊的変更の有無

---

## 安全
- トークン/秘密情報は出力しない
- 機密ファイル（secrets/配下、credentials等）は読み取らない

---

## ドキュメント参照
- 実装提案前に公式ドキュメントで一次情報を確認
- 参照したバージョンを明示（例：v2.1.0 前提）
- プロジェクトの実バージョン（pyproject.toml / package.json等）を先に確認

---

## 言語別設計方針
- Python: @~/.claude/languages/python.md
- Node.js: @~/.claude/languages/node.md
- Java: @~/.claude/languages/java.md
