#!/bin/bash

#
# apply dotfiles to your home
#

_REPOS="https://github.com/unagi/dotfiles.git"
_BACKUPDIR=".backup_dotfiles"

cmd_chk() {
    which $1 > /dev/null
    [ $? -ne 0 ] && echo "Please install \"$1\" before execute." >&2 && exit 1
}

case "${OSTYPE}" in
    freebsd*|darwin*)
        cmd_chk brew
        brew install autojump coreutils colordiff colorsvn nmap wget
        ;;
    *)
        echo "who"
        ;;
esac

cmd_chk git
cmd_chk vim

cd ~
if [ ! -d ~/dotfiles ]; then
    git clone ${_REPOS}
fi
cd dotfiles
git submodule update --init --recursive
cd ~

if [ -d ${_BACKUPDIR} ]; then
    rm -rf ${_BACKUPDIR}
fi

mkdir -p ${_BACKUPDIR}
for l in `find dotfiles -mindepth 1 -maxdepth 1 ! -name '.git*' -a ! -name 'README' -a ! -name 'apply_dotfiles'`; do
    [ -a `basename $l` ] && mv `basename $l` ${_BACKUPDIR}/ 
    ln -s $l `basename $l`
done

echo "Please exec this command"
echo "vim +BundleInsall +qall"

exit 0
